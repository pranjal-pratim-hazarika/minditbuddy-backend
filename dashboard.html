<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>calmIt</title>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <link href="https://fonts.googleapis.com/css?family=Nunito&display=swap"rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inconsolata&family=MuseoModerno:wght@300&display=swap" rel="stylesheet"> 
    <link href="https://fonts.googleapis.com/css?family=Baloo+Thambi+2&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300&display=swap" rel="stylesheet"> 

    <link rel="stylesheet" href="dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

</head>

<body>


    <div class="App">

        <div class="flex-container">
            <div class="sidebar">
                <div class="sidebar-wrapper">
                    <div>
                       <h3 class="sidebar-title">MindItBuddy</h3>
                       <div class="title-pill">Peace Of Mind</div>
                       <div class="sidebar-username"> 
                           <span id="userName">  </span> <br />
                           <span class="DO">
                               <i id="activeCircle" class="fas fa-circle" style="color: springgreen;font-size: 10px;margin-right: 2px;"></i>
                               <span id="greet" style="font-size: 0.95em;"> Online </span>
                            </span>
                           <div class="circle">
                               <i class="fas fa-pen edit"></i>
                               <img id="avatar" src="https://i0.wp.com/s3-us-west-1.amazonaws.com/unykmedia/wp-content/uploads/2020/02/08034620/photo_2020-02-08_08-45-38.jpg?fit=1280%2C720&ssl=1"
                                alt="profile-pic" width="45" height="45" style="object-fit: cover;" />
                           </div>
                       </div>
                    </div>

                    <div class="infoCard">
                        <div class="displayEmail">
                            <div class="styleDiv"></div>
                            <i class="far fa-envelope-open" style="color: cornflowerblue;margin-right: 0.5em;"></i>
                            <span id="emailFromStorage">test@gmail.com</span>
                        </div>
                        <div class="displayEmail">
                            <div class="styleDiv"></div>
                            <i class="far fa-gem" style="color: cornflowerblue;margin-right: 0.5em;"></i>
                            <span>Member Since<span id="registeredOn"></span> </span>
                        </div>
                    </div>

                    <!-- ------------------Rendered List Of Chats------------------------ -->

                    <div id="chatList" class="chats">
                        <div style="margin-bottom: 1.4em;"> <h5> <i id="chatIconId" class="fas fa-comment-alt chatIcon" style="margin-right: 0.5em;color: cornflowerblue;" ></i> Messages </h5>
                        <div id="chatHighlightId" class="chatHighlight"></div> </div>
                            
                        <div class="chatMembers"><button onclick="listItem(this)">
                                <div class="memberStyle"><img id="memberAvatar" src="https://cdn1.vectorstock.com/i/1000x1000/79/15/cute-cartoon-brunette-girl-icon-isolated-on-white-vector-12757915.jpg" alt="profile-pic" width="25" height="25" /></div>
                                <span>Nikhil Kalita</span>
                                <i id="" class="fas fa-trash-alt"></i>
                        </button></div>
                        <div class="chatMembers"><button onclick="listItem(this)">
                            <div class="memberStyle"><img id="memberAvatar" src="https://cdn1.vectorstock.com/i/1000x1000/79/15/cute-cartoon-brunette-girl-icon-isolated-on-white-vector-12757915.jpg" alt="profile-pic" width="25" height="25" /></div>
                            <span>Sandeep Biswas</span>
                            <i id="" class="fas fa-trash-alt"></i>
                        </button></div>
                        <div class="chatMembers"><button onclick="listItem(this)">
                            <div class="memberStyle"><img id="memberAvatar" src="https://cdn1.vectorstock.com/i/1000x1000/79/15/cute-cartoon-brunette-girl-icon-isolated-on-white-vector-12757915.jpg" alt="profile-pic" width="25" height="25" /></div>
                            <span>Pranjal Pratim Hazarika</span>
                            <i id="" class="fas fa-trash-alt"></i>
                        </button></div>
                    </div>

                    <!-- -------------------------end of Rendered List-------------------------------- -->

                    <div class="logout-box">
                        <button class="logout" type="button" onclick="logoutAction()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>

                </div>
            </div>
         
            <div id="chatWindow" class="display">

    <!-- ----------------------------setting Modal section------------------------------ -->
                <div id="dashboardModal" class="dashboardModal">
                    <!-- ----------UpdateProfile------------- -->
                    <div id="updateProfile">
                        <button id="closeBtn" type="button" onclick="closeModal()">&times;</button>
                        <div id="updateProfileInner">
                            <h2 style="font-family: nunito;color: rgb(49, 113, 165);">Update Your Profile Name</h2>
                            <div style="height:40px;border-left:5px solid rgb(45, 114, 170);margin-top:-3.5em;"></div>
                            <div class="settingInput">
                                <!-- <label style="font-family: 'Inconsolata', monospace;color: steelblue;">New Name:</label> -->
                                <input id="regName" type="text" placeholder="Enter Your Name" 
                                    style="font-size:1.2em;text-align:center;margin-left:0.8em;border:none;border-bottom:1px solid rgb(189, 189, 189);background:none;color: rgb(124, 124, 124);padding-bottom: 0.3em;">
                            </div>
                            <button class="updateProfileButton" type="button" onclick="updateProfileAction()">Update <i class="fas fa-wrench"></i></button>
                        </div>
                        <div id="updateProfileSuccess"></div>
                    </div>
                    <!-- ----------end of updateProfile--------- -->
                    <!-- --------------closeAccount--------------- -->
                    <div id="closeAccount">
                        <button id="closeBtn" type="button" onclick="closeModal()">&times;</button>
                        <div>
                            <h2 style="font-family: nunito;color: rgb(49, 113, 165);">Close Your Account</h2>
                            <div style="height:40px;border-left:5px solid rgb(45, 114, 170);margin-top:-3.5em;"></div>
                            <div class="settingInput">
                                <!-- <label style="font-family: 'Inconsolata', monospace;color: cornflowerblue;">Registered Email:</label> -->
                                <input id="regEmail" type="email" placeholder="Enter Your Email" 
                                    style="font-size:1.2em;text-align:center;margin-left:0.8em;border:none;border-bottom:1px solid rgb(189, 189, 189);background:none;color: rgb(124, 124, 124);padding-bottom: 0.3em;">
                            </div>
                            <button class="updateProfileButton" type="button" onclick="closeAccountAction()">Close <i class="fas fa-wrench"></i></button>
                        </div>
                    </div>
                    <!-- -------end of closeAccount-------------- -->
                    <!-- -----------ChnagePassword--------------- -->
                    <div id="changePassword">
                        <button id="closeBtn" type="button" onclick="closeModal()">&times;</button>
                        <div id="changePasswordInner">
                            <h2 style="font-family: nunito;color: rgb(49, 113, 165);">Change Your Password</h2>
                            <div style="height:40px;border-left:5px solid rgb(45, 114, 170);margin-top:-3.5em;"></div>
                            <div>
                                <input id="oldPassword" type="password" placeholder="Old Password">
                                <input id="newPassword" type="password" placeholder="New Password">
                            </div>
                            <div>
                                <button class="updateProfileButton" type="button" onclick="changePasswordAction()">Change Password <i class="fas fa-wrench"></i></button>
                            </div>
                        </div>
                        <div id="changePasswordSuccess"></div>
                        <span id="changePasswordError" style="text-align: center;font-size: 1em;color: lightcoral">
                            <br /><br />
                        </span>
                    </div>
                    <!-- -------end of changePassword--------- -->
                    <!-- ----------------send Feedback---------------- -->
                    <div id="sendFeedback" style="display: none;">
                    <button id="closeBtn" type="button" onclick="closeModal()">&times;</button>
                        <div id="displayOnSuccess" style="display: none;"></div>
                        <div id="hideOnSuccess">
                            <h2 style="font-family: nunito;color: rgb(49, 113, 165);">Send Feedback <i class="fas fa-comment-alt" style="color: steelblue;opacity: 0.5;"></i></h2>
                            <div style="height:40px;border-left:5px solid rgb(45, 114, 170);margin-top:-3.5em;"></div>
                            <div id="feedbackFlex">
                                <div class="flex1">
                                    <textarea id="feedbackInput" placeholder="Post Your Feedback" name="w3review" rows="4" cols="50"></textarea>
                                </div>
                                <div class="flex2">
                                    <button id="sendFeedbackAction" type="button" onclick="sendFeedbackAction()">
                                        <i class="far fa-paper-plane" style="font-size: 1.6em;color: #f1f1f1;"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- ------------end of feedback------------------ -->
                </div>
    <!-- ------------------------end of setting Modal Section--------------------------- -->

                <!-- ----------------Default Messages for Client-------------------- -->
                <div id="defaultMessage" class="defaultMessages">
                    <button id="defaultMessagesBtn" type="button" onclick="closeDefaultMessages()"> &times;</button>

                    <div class="bot">
                        <div style="width: 100px;height: 100px;border-radius: 50%;border: 1px solid grey;margin-top: 3em;margin-left: 1em;">
                            <img src="https://www.theweakestlink.es/wp-content/uploads/2017/04/bot-de-telegram.jpg" style="width:90px;height:90px;border-radius:50%;margin-top:0.3em;">
                        </div>
                        <div class="botMessageCard">
                            todo
                        </div>
                    </div>

                    <div class="user" style="float: right;margin-top: 2em;">
                        <div style="width: 100px;height: 100px;border-radius: 50%;border: 1px solid grey;margin-top:3em;margin-right:1em;float:right;">
                            <img src="https://www.pavilionweb.com/wp-content/uploads/2017/03/man-300x300.png" style="width:90px;height:90px;border-radius:50%;margin-top:0.3em;">
                        </div>
                        <div class="userMessageCard">
                            todo
                        </div>
                    </div>
                    
                </div>
                <!-- ---------------end of default messages------------------------- -->

                <!-- -------------Alert Box----------------- -->
                <div id="alertContainer">
                    <h2>Notofications <i class="far fa-bell"></i></h2>
                    <button id="closeNotifyBtn" type="button" onclick="closeNotify()">
                        &times;</button>

                    <div class="outerAlertBox">
                        <div class="alertBox" role="alert">
                            <strong>Hello!</strong>
                            <span>You should check in on some of those fields below. bfjhdf hdbfjdh hdjfbjdjjhfbd jdhfjdfj</span>
                            <div>
                                <button type="button">&times;</button>
                            </div>
                        </div>
                        <div class="url"><a href="#">
                            www.minditbuddy.in
                        </a></div> <br />
                        <div class="time"><span>
                            time
                        </span></div>
                    </div>
    
                </div>
                <!-- ----------end of alert----------------- -->

              <div id="chatWindowDisplay"><h1>Chat Window</h1>
              <div>
                  <button id="" type="button" onclick="renderList()">renderList</button>
                  <button id="" type="button" onclick="feedback()">feddback</button>
                  <button id="" type="button" onclick="notifyMe()">Notification</button>
                  <button id="" type="button" onclick="defaultMessages()">Messages</button>
              </div>
              <br /> <br />
              <div>
                  <button id="chatNow" type="button" onclick="chatNow()">Chat Now</button>
                  <button type="button" onclick="rightModal(this)">Setting</button>
              </div>
              
              <!-- -----------------------------right modal section--------------------- -->
              <div id="rightModal" class="right-modal">
                <button id="buttonRM" type="button" onclick="closeRM()">&times;</button>
                <h3 style="text-align: center;color: #f1f1f1">Setting 
                    <i class="fas fa-cog" style="font-size: 1.2em;color:#dddddd;"></i>
                </h3>
                  <div style="border-left:5px solid #f1f1f1;height:20px;margin-top:-2.6em;margin-bottom:5em;"></div>
                  <div class="right-modal-content">
                    <span>
                        <button type="button" onclick="updateProfile()">
                            <i class="fas fa-wrench" style="margin-right: 0.3em;"></i> Update profile</button>
                    </span>
                    <span>
                        <button type="button" onclick="changePassword()">
                            <i class="far fa-keyboard"style="margin-right: 0.3em;"></i> Change Password</button>
                    </span>
                    <span>
                        <button type="button" onclick="closeAccount()">
                            <i class="far fa-times-circle"style="margin-right: 0.3em;"></i> Close Account</button>
                    </span>
                  </div>
              </div> </div>
              <!-- ------------------------end of right modal------------------------------ -->
            </div>
            
        </div>
      </div>


    <script>

        function logoutAction() {
           document.getElementById("greet").innerHTML = "Signing... Off"; 
           document.getElementById("activeCircle").style.color = "crimson";
           document.getElementById("avatar").style.opacity = "0.35";

           sessionStorage.clear();
           document.location.href = "form.html";
        }
        function listItem(e) {
            document.getElementById("chatHighlightId").style.opacity = 0.7;
            document.getElementById("chatHighlightId").style.borderLeft = "4px solid ivory";
            document.getElementById("chatIconId").style.transform = ("scale(1.4)");
            e.style.color = "cornflowerblue";
        }
        function renderList() {
            document.getElementById("chatList").style.display = "block";
        }
        function rightModal(e) {
           document.getElementById("rightModal").style.display = "block";
           document.getElementById("rightModal").style.transform = "translateX(0px)";
        }

        function updateProfile() {
            document.getElementById("chatWindowDisplay").style.display = "none";
            document.getElementById("chatWindow").style.background = "#f1f1f1";
            document.getElementById("dashboardModal").style.display = "block";
            document.getElementById("closeAccount").style.display = "none";
            document.getElementById("changePassword").style.display = "none";
            document.getElementById("updateProfile").style.display = "block";
        }
        function closeModal() {
            document.getElementById("chatWindowDisplay").style.display = "block";
            document.getElementById("chatWindow").style.background = "rgb(226, 226, 226)";
            document.getElementById("dashboardModal").style.display = "none";

            document.getElementById("sendFeedback").style.display = "none"; 
        }
        function closeRM() {
            document.getElementById("rightModal").style.transform = "translateX(200px)";
            document.getElementById("rightModal").style.display = "none";
        }
        function closeAccount() {
            document.getElementById("chatWindowDisplay").style.display = "none";
            document.getElementById("chatWindow").style.background = "#f1f1f1";
            document.getElementById("dashboardModal").style.display = "block";
            document.getElementById("updateProfile").style.display = "none";
            document.getElementById("closeAccount").style.display = "block"; 
            document.getElementById("changePassword").style.display = "none"; 
        }
        function changePassword() {
            document.getElementById("chatWindowDisplay").style.display = "none";
            document.getElementById("chatWindow").style.background = "#f1f1f1";
            document.getElementById("dashboardModal").style.display = "block";
            document.getElementById("updateProfile").style.display = "none";
            document.getElementById("closeAccount").style.display = "none"; 
            document.getElementById("changePassword").style.display = "block"; 
        }
        function feedback() {
            document.getElementById("chatWindowDisplay").style.display = "none";
            document.getElementById("chatWindow").style.background = "#f1f1f1";
            document.getElementById("dashboardModal").style.display = "block";
            document.getElementById("updateProfile").style.display = "none";
            document.getElementById("closeAccount").style.display = "none"; 
            document.getElementById("changePassword").style.display = "none";
            document.getElementById("sendFeedback").style.display = "block";
        }
        
        function sendFeedbackAction() {
            document.getElementById("feedbackInput").style.padding = "0.1em 0.5em";
            let feedback = document.getElementById("feedbackInput").value;

            let email = JSON.parse(sessionStorage.getItem('myUniqueEmail'));
            let token = JSON.parse(sessionStorage.getItem('myUniqueUserToken'));
            const config = {
                headers: {
                    Authorization: `Bearer ${token}`
                }
            }
            axios.post('https://minditbuddy.herokuapp.com/api/v1/addFeedback', {
                email: email,
                feedback: feedback,
            }, config)
            .then(res => {
                document.getElementById("hideOnSuccess").style.display = "none";
                document.getElementById("displayOnSuccess").style.display = "block";
                document.getElementById("displayOnSuccess").innerHTML = "FeedBack Posted Successfully!";
                document.getElementById("displayOnSuccess").style.marginTop = "6em";
                window.setTimeout(function(){
                      document.getElementById("hideOnSuccess").style.display = "block";
                      document.getElementById("displayOnSuccess").style.display = "none";
                      document.getElementById("feedbackInput").value = "";
                      }, 2000);
            })
            .catch(err => console.error(err));
        }

        function closeAccountAction() {
            let token = JSON.parse(sessionStorage.getItem('myUniqueUserToken'));
            const config = {
                headers: {
                    Authorization: `Bearer ${token}`
                }
            }
            let email = document.getElementById("regEmail").value;
            axios.post('https://minditbuddy.herokuapp.com/api/v1/closeAccount', {
                email: email,
            }, config)
            .then(res => {
                document.getElementById("closeAccount").innerHTML = "Account Deleted!";
                document.getElementById("closeAccount").style.textAlign = "center";
                document.getElementById("closeAccount").style.fontSize = "2em";
                document.getElementById("closeAccount").style.color = "#316cab";
                document.getElementById("closeAccount").style.paddingTop = "3em";
                
                sessionStorage.clear();
                window.setTimeout(function(){
                      window.location.href = "form.html";
                      }, 3000);
            })
            .catch(err => console.error(err));
        } 

        function updateProfileAction() {
            let token = JSON.parse(sessionStorage.getItem('myUniqueUserToken'));
            let email = JSON.parse(sessionStorage.getItem('myUniqueEmail'));
            const config = {
                headers: {
                    Authorization: `Bearer ${token}`
                }
            }
            let name = document.getElementById("regName").value;
            axios.post('https://minditbuddy.herokuapp.com/api/v1/updateProfile', {
                name: name,
                email: email,
            }, config)
            .then(res => {
                document.getElementById("updateProfileInner").style.display = "none";
                document.getElementById("updateProfileSuccess").innerHTML = "Successfully Changed!";
                document.getElementById("updateProfileSuccess").style.textAlign = "center";
                document.getElementById("updateProfileSuccess").style.fontSize = "2em";
                document.getElementById("updateProfileSuccess").style.color = "#316cab";
                document.getElementById("updateProfileSuccess").style.paddingTop = "3em";
                
                window.setTimeout(function(){
                      document.getElementById("userName").innerHTML = name;
                      document.getElementById("updateProfileSuccess").style.display = "none";
                      document.getElementById("updateProfileInner").style.display = "block";
                      document.getElementById("regName").value = "";
                      }, 1500);
            })
            .catch(err => console.error(err)); 
        }

        function changePasswordAction() {
            let token = JSON.parse(sessionStorage.getItem('myUniqueUserToken'));
            let email = JSON.parse(sessionStorage.getItem('myUniqueEmail'));
            const config = {
                headers: {
                    Authorization: `Bearer ${token}`
                }
            }
            let oldPassword = document.getElementById("oldPassword").value;
            let newPassword = document.getElementById("newPassword").value;
            axios.post('https://minditbuddy.herokuapp.com/api/v1/changePassword', {
                email: email,
                oldPassword: oldPassword,
                newPassword: newPassword
            }, config)
            .then(res => {
                document.getElementById("changePasswordInner").style.display = "none";
                document.getElementById("changePasswordSuccess").innerHTML = "Successfully Changed!";
                document.getElementById("changePasswordSuccess").style.textAlign = "center";
                document.getElementById("changePasswordSuccess").style.fontSize = "2em";
                document.getElementById("changePasswordSuccess").style.color = "#316cab";
                document.getElementById("changePasswordSuccess").style.paddingTop = "3em";

                document.getElementById("changePasswordError").style.display = "none";

                window.setTimeout(function(){
                      document.getElementById("changePasswordSuccess").style.display = "none";
                      document.getElementById("changePasswordInner").style.display = "block";
                      document.getElementById("oldPassword").value = "";
                      document.getElementById("newPassword").value = "";
                      }, 1500);
            })
            .catch(err => {
                document.getElementById("changePasswordError").innerHTML = "Old Password is Not Valid!"
            });
        }
        function notifyMe() {
            document.getElementById("chatWindowDisplay").style.display = "none";
            document.getElementById("alertContainer").style.display = "block";

            let user_type = JSON.parse(sessionStorage.getItem('myUniqueUserType'));
            let token = JSON.parse(sessionStorage.getItem('myUniqueUserToken'));
            
            axios.get('https://minditbuddy.herokuapp.com/api/v1/viewNotification',{
                params: {
                    user_type: user_type
                },
                headers: {
                    Authorization: `Bearer ${token}`
                }
            })
            .then(res => {
                console.log(res);
            })
            .catch(err => console.error(err));
        }
        function closeNotify() {
            document.getElementById("chatWindowDisplay").style.display = "block";
            document.getElementById("alertContainer").style.display = "none"; 
        }
        function defaultMessages() {
            document.getElementById("chatWindowDisplay").style.display = "none";
            document.getElementById("defaultMessage").style.display = "block";
        }
        function closeDefaultMessages() {
            document.getElementById("chatWindowDisplay").style.display = "block";
            document.getElementById("defaultMessage").style.display = "none";
        }

        // --------------------------------------------------------------------------------

        var jsonfile;
         let email = JSON.parse(sessionStorage.getItem('myUniqueEmail'));
         let url = "https://minditbuddy.herokuapp.com/api/v1/dashboard?email=" + email;
         let token = JSON.parse(sessionStorage.getItem('myUniqueUserToken'));

            if(email != null) {
                document.getElementById("emailFromStorage").innerHTML = `${email}`;
            }

             let h = new Headers();
             h.append('Authorization', `Bearer ${token}`)

             let req = new Request(url, {
                 method: 'GET',
                 mode: 'cors',
                 headers: h,
             });

             fetch(req)
             .then(resp => resp.json())
             .then(data => {
              jsonfile = data;
                
               if(jsonfile.success == false) {
                  document.location.href = "form.html";
               }
                document.getElementById("userName").innerHTML = jsonfile.name;
                document.getElementById("registeredOn").innerHTML = jsonfile.member_since;
             })

            function chatNow() {
                axios.get('https://minditbuddy.herokuapp.com/?roomname=007&name=nikhil')
                .then(res => {
                    console.log(res);
                })
                .catch(err => console.error(err));
            }
             
    </script>
</body>
</html>